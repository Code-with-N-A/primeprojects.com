<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporate Budget Tracker - User Accounts</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        input[type="text"], input[type="number"], input[type="search"] {
            width: 100%;
            max-width: 48%;
            padding: 12px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: #007bff;
            color: white;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        .account-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .account-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: 0.3s;
        }

        .account-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .account-card.selected {
            border: 3px solid #007bff;
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.3);
        }

        .account-card h3 {
            margin: 0;
            color: #333;
        }

        .account-card .balance {
            font-size: 1.5em;
            margin-top: 10px;
            color: #28a745;
        }

        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin-top: 10px;
        }

        .progress-bar .progress {
            height: 100%;
            border-radius: 10px;
        }

        .expense-list {
            margin-top: 40px;
            font-size: 1.1em;
            overflow-x: scroll;
        }

        .expense-list h3 {
            margin-bottom: 15px;
        }

        .expense-item {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .expense-item span {
            font-weight: bold;
        }

        .expense-item small {
            color: #888;
        }

        .expense-item .amount {
            color: #dc3545;
        }

        .expense-item .description {
            flex-grow: 1;
            padding-left: 15px;
        }

        .expense-item .time {
            font-size: 0.9em;
            color: #888;
        }

        .search-bar {
            margin-bottom: 20px;
            text-align: center;
        }

        input[type="search"] {
            width: 60%;
            max-width: 400px;
            padding: 10px;
            font-size: 1.1em;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .expense-record {
    display: flex;
    flex-direction: column;  /* Make all items stack vertically */
}

.action-btns {
    display: flex;
    flex-direction: column;  /* Place buttons in a vertical stack */
    margin-top: 10px;
}

.action-btns button {
    margin-bottom: 5px; /* Add some space between buttons */
}


      
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .input-group input,
            .action-btns button {
                width: 100%;
                margin-bottom: 10px;
            }

            .search-bar input {
                width: 80%;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8em;
            }

            .container {
                padding: 20px;
            }

            .account-card h3 {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
     <!--sin in-->
     <script src="gon_oder.js"></script>

    <div class="container">
        <h1> Budget Tracker </h1>
    
        <!-- Search Bar -->
        <div class="search-bar">
            <input type="search" id="searchAccount" placeholder="Search Accounts" oninput="filterAccounts()">
        </div>
    
        <!-- Budget and Account Creation Form -->
        <div class="input-group">
            <input type="text" id="accountName" placeholder="Account Name" />
            <input type="number" id="initialBudget" placeholder="Set Initial Budget (₹)" />
        </div>
        <button onclick="createAccount()">Create Account</button>
    
        <!-- Account List -->
        <div class="account-list" id="accountList">
            <h3>Accounts</h3>
        </div>
    
        <!-- Expense List -->
        <div class="expense-list" id="expenseList">
            <h3>Expense Records</h3>
        </div>
    
        <!-- Expense Input -->
        <div class="input-group">
            <input type="number" id="expenseAmount" placeholder="Add Expense (₹)" />
            <input type="text" id="expenseDescription" placeholder="Expense Description" />
        </div>
        <button onclick="addExpense()">Add Expense</button>

    </div>
    <script>
        let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
        let selectedAccountIndex = -1;
    
        // Create Account Function
        function createAccount() {
            let accountName = document.getElementById('accountName').value;
            let initialBudget = parseFloat(document.getElementById('initialBudget').value);
    
            if (accountName && initialBudget) {
                let account = {
                    name: accountName,
                    budget: initialBudget,
                    expenses: []
                };
                accounts.push(account);
                updateLocalStorage();
                renderAccountList();
                document.getElementById('accountName').value = '';
                document.getElementById('initialBudget').value = '';
            } else {
                alert("Please enter valid account name and initial budget.");
            }
        }
    
        // Render Account List with Improvements
        function renderAccountList() {
            let accountList = document.getElementById('accountList');
            accountList.innerHTML = '';
            accounts.forEach((account, index) => {
                let totalExpenses = getTotalExpenses(account);
                let remainingBudget = account.budget - totalExpenses;
    
                // Calculate progress as a percentage, avoiding invalid or negative values
                let progress = account.budget > 0 ? Math.max(0, (remainingBudget / account.budget) * 100) : 0;
    
                // Calculate spent amount to show on hover
                let spentAmount = totalExpenses.toFixed(2);
    
                let accountCard = document.createElement('div');
                accountCard.className = 'account-card';
                accountCard.innerHTML = `
                    <h3>${account.name}</h3>
                    <div class="balance">Budget: ₹${account.budget}</div>
                    <div class="progress-bar" title="Spent: ₹${spentAmount} / Total: ₹${account.budget}">
                        <div class="progress" style="width: ${progress}%; background: ${getProgressBarColor(progress)}; transition: width 0.5s;"></div>
                    </div>
                    <div class="action-btns">
                        <button onclick="deleteAccount(${index})">Delete</button>
                        <button onclick="updateAccount(${index})">Update</button>
                    </div>
                `;
                accountCard.onclick = () => selectAccount(index);
                accountList.appendChild(accountCard);
            });
        }
    
        // Function to get color based on progress percentage
        function getProgressBarColor(progress) {
            if (progress >= 50) {
                return `linear-gradient(90deg, #28a745, #85e085)`; // Green gradient for >50%
            } else if (progress > 0) {
                return `linear-gradient(90deg, #ffc107, #ffe680)`; // Yellow gradient for 1% - 50%
            } else {
                return `linear-gradient(90deg, #dc3545, #f08080)`; // Red gradient for 0%
            }
        }
    
        // Auto-refresh mechanism to update the progress bar whenever there's a change
        setInterval(function() {
            renderAccountList(); // Automatically refreshes every 5 seconds
        }, 5000); // Refresh every 5 seconds
    
        // Function to update the progress bar immediately when there's a change
        function updateProgressOnChange() {
            renderAccountList(); // Call this function every time an account is added, updated, or deleted
        }
    
        // Dummy function for getting total expenses (Replace with actual implementation)
        function getTotalExpenses(account) {
            // Placeholder logic for calculating total expenses
            return account.expenses.reduce((total, expense) => total + expense.amount, 0);
        }
    
        // Example: Add expense and immediately update the progress bar
        function addExpenseToAccount(accountIndex, expenseAmount) {
            accounts[accountIndex].expenses.push({ amount: expenseAmount });
            updateProgressOnChange(); // Update the progress bar after adding an expense
        }
    
        // Example: Delete expense and immediately update the progress bar
        function deleteAccount(accountIndex) {
            accounts.splice(accountIndex, 1);
            updateProgressOnChange(); // Update the progress bar after deleting an account
        }
    
        // Example: Update expense and immediately update the progress bar
        function updateAccount(accountIndex, newExpenseAmount) {
            accounts[accountIndex].expenses[0].amount = newExpenseAmount; // Example for updating the first expense
            updateProgressOnChange(); // Update the progress bar after updating an account
        }
    
        // Select Account and Show Details
        function selectAccount(index) {
            selectedAccountIndex = index;
            let account = accounts[selectedAccountIndex];
            let expenseList = document.getElementById('expenseList');
            expenseList.innerHTML = `<h3>Expense Records for ${account.name}</h3>`;
    
            account.expenses.forEach((expense, expIndex) => {
                let expenseItem = document.createElement('div');
                expenseItem.className = 'expense-item';
                expenseItem.innerHTML = `
                    <span class="amount">₹${expense.amount}</span>
                    <span class="description">${expense.description}</span>
                    <span class="time">${expense.time}</span>
                    <div class="action-btns">
                        <button onclick="deleteExpense(${index}, ${expIndex})">Delete</button>
                        <button onclick="updateExpense(${index}, ${expIndex})">Update</button>
                    </div>
                `;
                expenseList.appendChild(expenseItem);
            });
    
            let totalExpenses = getTotalExpenses(account);
            let balance = account.budget - totalExpenses;
            let balanceColor = balance >= 0 ? '#28a745' : '#dc3545';
    
            expenseList.innerHTML += `
                <div class="balance" style="color: ${balanceColor};">
                    Total Expenses: ₹${totalExpenses}<br>Remaining: ₹${balance}
                </div>
            `;
        }
    
        // Add Expense Function
        function addExpense() {
            if (selectedAccountIndex !== -1) {
                let expenseAmount = parseFloat(document.getElementById('expenseAmount').value);
                let expenseDescription = document.getElementById('expenseDescription').value;
    
                if (expenseAmount && expenseDescription) {
                    let expense = {
                        amount: expenseAmount,
                        description: expenseDescription,
                        time: new Date().toLocaleString()
                    };
    
                    accounts[selectedAccountIndex].expenses.push(expense);
                    updateLocalStorage();
                    selectAccount(selectedAccountIndex);
    
                    document.getElementById('expenseAmount').value = '';
                    document.getElementById('expenseDescription').value = '';
                } else {
                    alert("Please enter valid expense amount and description.");
                }
            } else {
                alert("Please select an account first.");
            }
        }
    
        // Delete Expense Function
        function deleteExpense(accountIndex, expenseIndex) {
            accounts[accountIndex].expenses.splice(expenseIndex, 1);
            updateLocalStorage();
            selectAccount(accountIndex);
        }
    
        // Delete Account Function
        function deleteAccount(accountIndex) {
            accounts.splice(accountIndex, 1);
            updateLocalStorage();
            renderAccountList();
        }
    
        // Update Account Function
        function updateAccount(accountIndex) {
            let newBudget = prompt("Enter new budget:", accounts[accountIndex].budget);
            if (newBudget !== null && !isNaN(newBudget)) {
                accounts[accountIndex].budget = parseFloat(newBudget);
                updateLocalStorage();
                renderAccountList();
            }
        }
    
        // Update Expense Function
        function updateExpense(accountIndex, expenseIndex) {
            let newAmount = prompt("Enter new expense amount:", accounts[accountIndex].expenses[expenseIndex].amount);
            let newDescription = prompt("Enter new expense description:", accounts[accountIndex].expenses[expenseIndex].description);
    
            if (newAmount !== null && !isNaN(newAmount) && newDescription !== null) {
                accounts[accountIndex].expenses[expenseIndex].amount = parseFloat(newAmount);
                accounts[accountIndex].expenses[expenseIndex].description = newDescription;
                updateLocalStorage();
                selectAccount(accountIndex);
            }
        }
    
        // Update Local Storage
        function updateLocalStorage() {
            localStorage.setItem('accounts', JSON.stringify(accounts));
        }
    
        // Filter Accounts by Search
        function filterAccounts() {
            let searchValue = document.getElementById('searchAccount').value.toLowerCase();
            let accountList = document.getElementById('accountList');
            let filteredAccounts = accounts.filter(account => account.name.toLowerCase().includes(searchValue));
            accountList.innerHTML = '';
            filteredAccounts.forEach((account, index) => {
                let accountCard = document.createElement('div');
                accountCard.className = 'account-card';
                accountCard.innerHTML = `
                    <h3>${account.name}</h3>
                    <div class="balance">Budget: ₹${account.budget}</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: ${(Math.max(0, (account.budget - getTotalExpenses(account)) / account.budget * 100))}%"></div>
                    </div>
                    <div class="action-btns">
                        <button onclick="deleteAccount(${index})">Delete</button>
                        <button onclick="updateAccount(${index})">Update</button>
                    </div>
                `;
                accountCard.onclick = () => selectAccount(accounts.indexOf(account));
                accountList.appendChild(accountCard);
            });
        }
    
        // Initial Render
        renderAccountList();
    </script>
    
</body>
</html>

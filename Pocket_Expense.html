<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pocket Expense</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: #fdf6ee;
        font-family: "Segoe UI", sans-serif;
        min-height: 100vh;
        transition: padding-left 0.3s ease;
        overflow: auto;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* Internet Explorer 10+ */
      }

      h2 {
        text-align: center;
        padding: 20px 10px;
        font-size: 28px;
        color: #02386f;
      }

      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100%;
        background-color: #011443;
        box-shadow: 2px 0 8px rgba(255, 255, 255, 0.1);
        padding: 20px;
        overflow-y: auto;
        z-index: 1000;
        transition: transform 0.3s ease;
        color: whitesmoke;
        overflow: auto;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* Internet Explorer 10+ */
      }

      @media (max-width: 768px) {
        #sidebar {
          transform: translateX(-270px);
        }
        #sidebar.open {
          transform: translateX(0);
        }
      }

      #toggleBtn {
        display: none;
        position: fixed;
        left: 10px;
        top: 10px;
        font-size: 24px;
        z-index: 1100;
        background: #2c3e50;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 14px;
        cursor: pointer;
      }

      @media (max-width: 768px) {
        #toggleBtn {
          display: block;
        }
      }

      .input-box {
        padding: 10px;
        margin: 10px 0;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 6px;
      }

      .sidebar-btn {
        width: 100%;
        background-color: #469cf8;
        color: white;
        border: none;
        padding: 10px;
        margin: 5px 0 15px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }

      #storesList {
        list-style: none;
        padding: 0;
      }

      .store-item {
        display: flex;
        align-items: center;
        box-shadow: 0 1px 5px 1px rgba(255, 255, 255, 0.1);
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 6px;
        cursor: pointer;
      }

      .avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        color: white;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 8px;
        flex-shrink: 0;
      }

      .store-item.active-store {
        background-color: #5504b8;
        font-weight: bold;
        color: rgb(255, 255, 255);
      }

      .input-box,
      select,
      button {
        max-width: 900px;
        display: block;
        margin: 10px auto;
      }

      button {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
      }

      .tb {
        max-width: 1000px;
        margin: 20px auto;
        overflow-x: auto; /* horizontal scroll (‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•à) */

        max-height: 400px; /* ‡§Ö‡§™‡§®‡•Ä ‡§Æ‡§®‡§™‡§∏‡§Ç‡§¶ height ‡§∏‡•á‡§ü ‡§ï‡§∞‡•ã */
        overflow-y: auto; /* vertical scroll ‡§ú‡•ã‡§°‡§º‡•ã */
        border: 1px solid #ccc; /* optional: border ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
        background: white;
        overflow: auto;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* Internet Explorer 10+ */
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: rgb(249, 255, 228);
        overflow: hidden;
      }

      th,
      td {
        background-color: #ffffff;
        color: rgb(0, 0, 0);
        padding: 10px;
        text-align: center;
        font-size: 14px;
        border: 1px solid black;
      }

      thead th {
        background-color: #1c014f;
        color: white;
      }

      tfoot td {
        background: #ecf0f1;
        font-weight: bold;
      }
      @media (min-width: 769px) {
        #toggleBtn {
          display: none !important;
        }
        #sidebar {
          transform: translateX(0) !important;
        }
        .content {
          margin-left: 270px;
          transition: margin-left 0.3s ease;
        }
      }

      @media (max-width: 768px) {
        .content {
          margin-left: 0;
          transition: margin-left 0.3s ease;
        }
        body.sidebar-open .content {
          margin-left: 250px;
        }
      }

      /* ‚úÖ Responsive row layout for inputs/buttons */
      .form-actions {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: stretch;
        gap: 12px;
        max-width: 1000px;
        margin: 20px auto;
        padding: 10px;
      }

      .form-actions input,
      .form-actions select,
      .form-actions button {
        flex: 1 1 180px;
        min-width: 150px;
        padding: 10px;
        font-size: 15px;
        border-radius: 6px;
        border: 1px solid #ccc;
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.05);
        background: rgb(255, 255, 255);
        transition: 0.2s;
        max-width: 100%;
        box-sizing: border-box;
       
      }

      /* ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§™‡§∞ ‡§õ‡•ã‡§ü‡•á ‡§ï‡§∞‡•á‡§Ç */
      @media (max-width: 600px) {
        .form-actions {
          flex-direction: column;
          align-items: stretch;
          gap: 10px;
          padding: 0 10px;
        }

        .form-actions input,
        .form-actions select,
        .form-actions button {
          min-width: auto;
          flex-basis: auto;
          width: 100%;
          font-size: 14px; /* ‡§•‡•ã‡•ú‡§æ ‡§õ‡•ã‡§ü‡§æ font */
          padding: 8px 12px; /* padding ‡§≠‡•Ä ‡§•‡•ã‡•ú‡§æ ‡§ï‡§Æ */
        }
      }
      .delete-btn {
  background-color: #ff4d4f;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.delete-btn:hover {
  background-color: #d9363e;
}

    </style>
  </head>
  <body>
    <button id="toggleBtn" onclick="toggleSidebar()">‚ò∞</button>

    <div id="sidebar">
      <input
        type="text"
        id="newAccountName"
        class="input-box"
        placeholder="Enter Account Name"
      />
      <button class="sidebar-btn" onclick="createNewStore()">
        ‚ûï Add Account
      </button>

      <input
        type="text"
        id="customHeading"
        class="input-box"
        placeholder="Add Custom Heading"
      />
      <button
        class="sidebar-btn"
        style="background-color: #cd0303"
        onclick="addHeading()"
      >
        ‚ûï Add Heading
      </button>

      <ul id="storesList"></ul>
    </div>

    <div class="content">
      <h2 id="heading">Pocket Expense</h2>

      <div class="form-actions">
        <input
          type="text"
          id="productName"
          class="input-box"
          placeholder="Product Name"
        />
        <input
          type="number"
          id="productPrice"
          class="input-box"
          placeholder="Price"
        />
        <select id="transactionType" class="input-box">
          <option value="credit">Credit</option>
          <option value="debit">Debit</option>
        </select>
        <button
          onclick="addProduct()"
          style="background-color: #1c014f; color: white"
        >
          Add Product
        </button>
      </div>
      <div class="tb">
        <table>
          <thead>
            <tr>
              <th>S.No</th>
              <th>Product Name</th>
              <th>Price</th>
              <th>Total</th>
              <th>Type</th>
              <th>Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="productTableBody"></tbody>
          <tfoot>
            <tr>
              <td colspan="3">Total Credit</td>
              <td colspan="4" id="totalCredit">‚Çπ0</td>
            </tr>
            <tr>
              <td colspan="3">Total Debit</td>
              <td colspan="4" id="totalDebit">‚Çπ0</td>
            </tr>
            <tr>
              <td colspan="3">Total Balance</td>
              <td colspan="4" id="totalBalance">‚Çπ0</td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div class="form-actions">
        <button
          style="background-color: #f39c12; color: #ffffff"
          onclick="downloadPDF()"
          class="download-btn"
        >
          Download PDF
        </button>
        <button
          onclick="downloadExcel()"
          class="download-btn"
          style="background-color: #035206; color: whitesmoke"
        >
          Download Excel
        </button>
        <button
          style="background-color: rgb(217, 10, 10); color: whitesmoke"
          onclick="deleteAllProducts()"
          class="delete-btn"
        >
          Delete All
        </button>
      </div>
    </div>

    <script>
      // ‚úÖ Global variable so every function can access and modify it
      var activeStore = localStorage.getItem("activeStore") || "defaultStore";
      let sidebarVisible = window.innerWidth > 768; // for responsive toggle

      const toggleBtn = document.getElementById("toggleBtn");
      const sidebar = document.getElementById("sidebar");

      // üîÅ Sidebar Toggle
      function toggleSidebar() {
        sidebar.classList.toggle("open");
        sidebar.classList.toggle("closed");
      }

      // ‚úÖ Auto-close sidebar on small screens when clicking outside
      document.addEventListener("click", (e) => {
        if (
          !sidebar.contains(e.target) &&
          !toggleBtn.contains(e.target) &&
          sidebar.classList.contains("open") &&
          window.innerWidth <= 768
        ) {
          toggleSidebar();
        }
      });

      // üî† Convert string to Title Case
      function toTitleCase(str) {
        return str
          .toLowerCase()
          .split(" ")
          .filter((word) => word.trim() !== "")
          .map((word) => word[0].toUpperCase() + word.slice(1))
          .join(" ");
      }

      // üé® Fixed palette of colors for avatars
      const colors = [
        "#f44336",
        "#e91e63",
        "#9c27b0",
        "#3f51b5",
        "#2196f3",
        "#009688",
        "#4caf50",
        "#ff9800",
        "#795548",
      ];

      // üü¢ Get initials (first letter of first and last word)
      function getInitials(name) {
        const parts = name.trim().split(" ");
        const first = parts[0]?.[0] || "";
        const second = parts[1]?.[0] || "";
        return (first + second).toUpperCase();
      }

      // üß† Load sidebar store list
      function loadStores() {
        let stores = JSON.parse(localStorage.getItem("stores")) || [];
        let storesList = document.getElementById("storesList");
        storesList.innerHTML = "";

        stores.forEach((store, i) => {
          let displayName = toTitleCase(store);
          let isActive = store === activeStore;

          let li = document.createElement("li");
          li.className = "store-item" + (isActive ? " active-store" : "");
          li.onclick = () => {
            setActiveStore(store);
            if (window.innerWidth <= 768) toggleSidebar();
          };

          const avatar = document.createElement("div");
          avatar.className = "avatar";
          avatar.textContent = getInitials(store);
          avatar.style.backgroundColor = colors[i % colors.length];

          const name = document.createElement("div");
          name.className = "store-name";
          name.textContent = displayName;

          li.appendChild(avatar);
          li.appendChild(name);
          storesList.appendChild(li);
        });
      }

      // ‚úÖ Set selected store and reload data
      function setActiveStore(store) {
        activeStore = store;
        localStorage.setItem("activeStore", activeStore);
        loadStores();
        loadProducts(); // Make sure this function is defined elsewhere
      }

      // ‚ûï Prompt user to create new store
      function createNewStore() {
        let input = document.getElementById("newAccountName");
        let newStoreName = input.value.trim();

        if (!newStoreName) {
          alert("Please enter a store name.");
          return;
        }

        newStoreName = toTitleCase(newStoreName);
        let stores = JSON.parse(localStorage.getItem("stores")) || [];

        if (stores.includes(newStoreName)) {
          alert("Store name already exists! Choose a different name.");
          return;
        }

        stores.push(newStoreName);
        localStorage.setItem("stores", JSON.stringify(stores));
        localStorage.setItem(newStoreName, JSON.stringify([]));

        input.value = ""; // Clear the input box after creation
        setActiveStore(newStoreName); // Also calls loadStores() + loadProducts()
      }

    function addProduct() {
  let name = toTitleCase(
    document.getElementById("productName").value.trim()
  );
  let price = document.getElementById("productPrice").value;
  let type = document.getElementById("transactionType").value;
  let date = new Date().toLocaleDateString();

  if (!name || !price) {
    alert("Please enter both product name and price.");
    return;
  }

  let products = JSON.parse(localStorage.getItem(activeStore)) || [];
  products.push({ name, price, type, date });
  localStorage.setItem(activeStore, JSON.stringify(products));

  document.getElementById("productName").value = "";
  document.getElementById("productPrice").value = "";
  loadProducts();
}

function loadProducts() {
  const tbody = document.getElementById("productTableBody");
  if (!tbody) return;

  tbody.innerHTML = "";

  const products = JSON.parse(localStorage.getItem(activeStore)) || [];

  let sn = 1;
  let totalCredit = 0;
  let totalDebit = 0;

  products.forEach((product, index) => {
    if (product.isHeading) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="7" style="font-weight:bold; background:#eee; text-align:center;">${product.heading}</td>`;
      tbody.appendChild(tr);
      return;
    }

    const tr = document.createElement("tr");
    const price = parseFloat(product.price);
    let showTotal = 0;

    if (product.type === "credit") {
      totalCredit += price;
      showTotal = totalCredit;
    } else {
      totalDebit += price;
      showTotal = totalDebit;
    }

    tr.innerHTML = `
      <td>${sn++}</td>
      <td>${product.name}</td>
      <td>${price.toFixed(2)}</td>
      <td>${showTotal.toFixed(2)}</td>
      <td style="color:${product.type === "credit" ? "green" : "red"}">
        ${product.type}
      </td>
      <td>${product.date}</td>
      <td>
        <button class="delete-btn" onclick="deleteProduct(${index})">Delet</button>
      </td>
    `;

    tbody.appendChild(tr);
  });

  if (document.getElementById("totalCredit"))
    document.getElementById("totalCredit").innerText = totalCredit.toFixed(2);
  if (document.getElementById("totalDebit"))
    document.getElementById("totalDebit").innerText = totalDebit.toFixed(2);
  if (document.getElementById("totalBalance"))
    document.getElementById("totalBalance").innerText = (totalCredit - totalDebit).toFixed(2);
}

window.onload = () => {
  loadStores();
  loadProducts();
};

function addHeading() {
  let heading = toTitleCase(
    document.getElementById("customHeading").value.trim()
  );
  if (!heading) {
    alert("Please enter a heading.");
    return;
  }

  let products = JSON.parse(localStorage.getItem(activeStore)) || [];
  products.push({ isHeading: true, heading });
  localStorage.setItem(activeStore, JSON.stringify(products));

  document.getElementById("customHeading").value = "";
  loadProducts();
}

function deleteProduct(index) {
  let products = JSON.parse(localStorage.getItem(activeStore)) || [];
  products.splice(index, 1);
  localStorage.setItem(activeStore, JSON.stringify(products));
  loadProducts();
}

function deleteAllProducts() {
  if (
    confirm(
      `Are you sure you want to delete the entire store "${toTitleCase(
        activeStore
      )}"?`
    )
  ) {
    localStorage.removeItem(activeStore);

    let stores = JSON.parse(localStorage.getItem("stores")) || [];
    stores = stores.filter((store) => store !== activeStore);
    localStorage.setItem("stores", JSON.stringify(stores));

    if (stores.length > 0) {
      activeStore = stores[0];
      localStorage.setItem("activeStore", activeStore);
    } else {
      activeStore = "defaultStore";
      localStorage.setItem("activeStore", activeStore);
      localStorage.setItem("stores", JSON.stringify([activeStore]));
      localStorage.setItem(activeStore, JSON.stringify([]));
    }

    loadStores();
    loadProducts();
    alert("Store deleted successfully.");
  }
}


      // PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ function (jsPDF + autotable ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤)
      function downloadPDF() {
        const { jsPDF } = window.jspdf;
        let doc = new jsPDF();
        doc.setFontSize(18);
        doc.text(`Pocket Expense - ${toTitleCase(activeStore)}`, 70, 15);

        let products = JSON.parse(localStorage.getItem(activeStore)) || [];
        let totalCredit =
          document.getElementById("totalCredit").innerText || "0.00";
        let totalDebit =
          document.getElementById("totalDebit").innerText || "0.00";
        let totalBalance =
          document.getElementById("totalBalance").innerText || "0.00";

        let tableData = [];
        let displayIndex = 1;
        let cumulativeCredit = 0,
          cumulativeDebit = 0;

        products.forEach((product) => {
          if (product.isHeading) {
            tableData.push([
              {
                content: toTitleCase(product.heading),
                colSpan: 6,
                styles: {
                  halign: "center",
                  fontStyle: "bold",
                  fillColor: [230, 230, 230],
                },
              },
            ]);
          } else {
            let color = product.type === "credit" ? [0, 128, 0] : [255, 0, 0];
            let price = parseFloat(product.price);
            let totalCell = "";

            if (product.type === "credit") {
              cumulativeCredit += price;
              totalCell = cumulativeCredit.toFixed(2);
            } else {
              cumulativeDebit += price;
              totalCell = cumulativeDebit.toFixed(2);
            }

            tableData.push([
              displayIndex++,
              toTitleCase(product.name),
              { content: price.toFixed(2), styles: { textColor: color } },
              totalCell,
              {
                content:
                  product.type.charAt(0).toUpperCase() + product.type.slice(1),
                styles: { textColor: color },
              },
              product.date,
            ]);
          }
        });

        doc.autoTable({
          head: [["S.No", "Name", "Price", "Total", "Type", "Date"]],
          body: tableData,
          theme: "grid",
          startY: 20,
          styles: { fontSize: 10 },
          headStyles: { fillColor: [100, 149, 237], textColor: 255 },
        });

        let finalY = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(12);
        doc.text(`Total Credit: ${totalCredit}`, 14, finalY);
        doc.text(`Total Debit: ${totalDebit}`, 14, finalY + 8);
        doc.text(`Total Balance: ${totalBalance}`, 14, finalY + 16);

        doc.save(`Pocket_Expense_${toTitleCase(activeStore)}.pdf`);
      }

      function setActiveStore(store) {
        activeStore = store;
        localStorage.setItem("activeStore", activeStore);
        loadStores();
        loadProducts();

        // ‚úÖ Heading ‡§≠‡•Ä update ‡§ï‡§∞ ‡§¶‡•ã:
        const headingEl = document.getElementById("heading");
        headingEl.textContent = `${toTitleCase(activeStore)}`;
      }

      // Excel ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ function (SheetJS/XLSX)
      function downloadExcel() {
        let products = JSON.parse(localStorage.getItem(activeStore)) || [];
        let tableData = [];
        let sn = 1;
        let cumulativeCredit = 0,
          cumulativeDebit = 0;

        // ‡§π‡•á‡§°‡§∞
        tableData.push([
          "S.No",
          "Expense Name",
          "Price",
          "Total",
          "Type",
          "Date",
        ]);

        products.forEach((product) => {
          if (product.isHeading) {
            // Heading ‡§ï‡•ã ‡§™‡•Ç‡§∞‡§æ ‡§è‡§ï ‡§ï‡•â‡§≤‡§Æ ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡•á‡§Ç
            tableData.push([toTitleCase(product.heading), "", "", "", "", ""]);
          } else {
            let price = parseFloat(product.price);
            let totalCell = "";

            if (product.type === "credit") {
              cumulativeCredit += price;
              totalCell = cumulativeCredit.toFixed(2);
            } else {
              cumulativeDebit += price;
              totalCell = cumulativeDebit.toFixed(2);
            }

            tableData.push([
              sn++,
              toTitleCase(product.name),
              price.toFixed(2),
              totalCell,
              product.type.charAt(0).toUpperCase() + product.type.slice(1),
              product.date,
            ]);
          }
        });

        let totalCredit = cumulativeCredit.toFixed(2);
        let totalDebit = cumulativeDebit.toFixed(2);
        let totalBalance = (cumulativeCredit - cumulativeDebit).toFixed(2);

        tableData.push([]);
        tableData.push(["Total Credit", totalCredit]);
        tableData.push(["Total Debit", totalDebit]);
        tableData.push(["Total Balance", totalBalance]);

        let ws = XLSX.utils.aoa_to_sheet(tableData);
        let wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Pocket Expense");
        XLSX.writeFile(wb, `Pocket_Expense_${toTitleCase(activeStore)}.xlsx`);
      }

      // ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§§‡•á ‡§π‡•Ä ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
      window.onload = function () {
        let stores = JSON.parse(localStorage.getItem("stores")) || [];
        if (stores.length === 0) {
          stores = ["defaultStore"];
          localStorage.setItem("stores", JSON.stringify(stores));
          localStorage.setItem("defaultStore", JSON.stringify([]));
          localStorage.setItem("activeStore", "defaultStore");
          activeStore = "defaultStore";
        } else {
          activeStore = localStorage.getItem("activeStore") || stores[0];
          localStorage.setItem("activeStore", activeStore);
        }

        loadStores();
        loadProducts();
      };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  </body>
</html>

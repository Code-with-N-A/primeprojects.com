<!DOCTYPE html>
<html lang="en">
<head>
 <!-- Charset and Viewport -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Title and Description -->
<title>Wedding Dowry Records | CodeWith_N.A</title>
<meta name="description" content="Manage and access wedding dowry records online easily. Securely maintain your dowry data with CodeWith_N.A.">
<meta name="keywords" content="dowry records, wedding dowry, dowry data, online dowry records, CodeWith_N.A">
<meta name="author" content="CodeWith_N.A">
<meta name="title" content="Donation Record Archive | Preserve History with CodeWith_N.A">
<meta name="description" content="A powerful PDF generator tool by CodeWith_N.A to archive donation records for generations. Securely document names, villages, amounts, and payment types.">

<!-- Keywords -->
<meta name="keywords" content="Donation Record, PDF Generator, Historical Donation Archive, CodeWith_N.A, jsPDF, AutoTable, Long-term Record Keeping, Digital Archive, Village Donations">

<!-- Author -->
<meta name="author" content="CodeWith_N.A">

<!-- Language -->
<meta name="language" content="en">
<meta name="robots" content="index, follow">

<!-- Cache Control (for long-term static pages) -->
<meta http-equiv="Cache-Control" content="max-age=31536000, immutable">
<meta property="og:type" content="website">
<meta property="og:url" content="https://yourwebsite.com/donation-archive">
<meta property="og:title" content="Donation Archive | CodeWith_N.A">
<meta property="og:description" content="Secure and preserve donation records in PDF format for generations. Created by CodeWith_N.A.">
<meta property="og:image" content="https://yourwebsite.com/assets/donation-archive-cover.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://yourwebsite.com/donation-archive">
<meta name="twitter:title" content="Donation Record Archive | CodeWith_N.A">
<meta name="twitter:description" content="A digital tool to archive historical donations securely in PDF format. Trusted by generations.">
<meta name="twitter:image" content="https://yourwebsite.com/assets/donation-archive-cover.jpg">
<link rel="icon" href="https://yourwebsite.com/favicon.ico" type="image/x-icon">
<link rel="canonical" href="https://yourwebsite.com/donation-archive">
<!--meta khatam -->


  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    /* Tailwind border override for thin borders */
    table, th, td {
      border-width: 0.5px !important; /* पतली बॉर्डर */
      border-style: solid !important;
      border-color: #a0aec0 !important; /* हल्का ग्रे */
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 flex flex-col items-center">
   <!-- Loader Wrapper strat -->
   <link rel="stylesheet" href="loder.css">
   <script src="loder.js"></script>
   <div id="load-screen">
      <div class="circle-animation"></div>
      <div class="loading-text">primeprojects...</div>
    </div>
  <!-- Loader Wrapper and -->
   <!--sin in-->
   <script src="sin.js"></script>
  

  <div class="max-w-5xl w-full bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-center mb-6 text-blake-800">Wedding Dowry Records</h1>
    <!-- Heading Input -->
    <div class="mb-6 flex flex-col md:flex-row md:items-center md:gap-4">
      <input id="topHeading" type="text" placeholder="Enter Top Heading"  class="flex-1 border p-2 rounded mb-3 md:mb-0"/>
      <button id="addHeadingBtn"   class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition">Add Heading</button>
    </div>

    <!-- SHOW heading on page -->
    <h1 id="headingDisplay" class="text-2xl font-bold text-center mb-6 text-blue-800"></h1>

    <form id="entryForm" onsubmit="event.preventDefault(); addEntry();" class="grid grid-cols-1 sm:grid-cols-5 gap-4 mb-4">
      <input id="name" type="text" placeholder="Name" class="border p-2 rounded" required />
      <input id="village" type="text" placeholder="Village Name" class="border p-2 rounded" required />
      <input id="item" type="text" placeholder="Item Name" class="border p-2 rounded" required />
      <input id="quantity" type="number" placeholder="Quantity" min="1" class="border p-2 rounded" required />
      <button type="submit" class="bg-green-600 text-white rounded px-5 py-2 hover:bg-green-700">Add</button>
    </form>

    <div class="overflow-x-auto max-h-[60vh] mb-6">
      <table class="table-auto w-full text-center border border-gray-300">
        <thead class="bg-blue-100 text-blue-900 font-bold sticky top-0">
          <tr>
            <th class="border px-3 py-2">NO</th>
            <th class="border px-3 py-2">Name</th>
            <th class="border px-3 py-2">Village</th>
            <th class="border px-3 py-2">Item Name</th>
            <th class="border px-3 py-2">Quantity</th>
            <th class="border px-3 py-2">Delete</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <!-- Summary Area -->
    <div id="summary" class="text-left text-lg font-semibold space-y-2 text-blue-900 mb-6"></div>

      <div class="mt-6 flex justify-center gap-4 flex-wrap">
      <button onclick="generatePDF()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Download PDF</button>
      <button onclick="deleteAll()" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">Delete All</button>
      <button onclick="window.location.href='Sadi_Money.html'" style= "padding: 5px; background-color: rgb(85, 85, 245); color: whitesmoke; font-size: medium; border-radius: 5px;">GO Payment</button>

    </div>
  </div>

<script>
let data = JSON.parse(localStorage.getItem('itemData')) || [];
let heading = localStorage.getItem('heading') || "Item Entry List";

// Capitalize each word
function capitalizeWords(str) {
  return str
    .split(' ')
    .filter(Boolean)
    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
    .join(' ');
}

function normalizeItemName(name) {
  return name.replace(/\s+/g, '').toLowerCase();
}

function saveData() {
  localStorage.setItem('itemData', JSON.stringify(data));
  localStorage.setItem('heading', heading);
}

// Add entry
function addEntry() {
  const nameInput = document.getElementById('name');
  const villageInput = document.getElementById('village');
  const itemInput = document.getElementById('item');
  const quantityInput = document.getElementById('quantity');

  const nameVal = capitalizeWords(nameInput.value.trim());
  const villageVal = capitalizeWords(villageInput.value.trim());
  const itemVal = capitalizeWords(itemInput.value.trim());
  const quantityVal = Number(quantityInput.value);

  data.push({ name: nameVal, village: villageVal, item: itemVal, quantity: quantityVal });

  saveData();

  nameInput.value = '';
  villageInput.value = '';
  itemInput.value = '';
  quantityInput.value = '';

  renderTable();
}

function deleteRow(index) {
  data.splice(index, 1);
  saveData();
  renderTable();
}

function deleteAll() {
  if (confirm("Are you sure you want to delete all entries?")) {
    data = [];
    saveData();
    renderTable();
  }
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';

  const itemCount = {};
  data.forEach(entry => {
    const normName = normalizeItemName(entry.item);
    itemCount[normName] = (itemCount[normName] || 0) + 1;
  });

  data.forEach((entry, idx) => {
    const tr = document.createElement('tr');
    const isDuplicate = itemCount[normalizeItemName(entry.item)] > 1;
    if (isDuplicate) tr.classList.add('text-red-600', 'font-semibold');

    tr.innerHTML = `
      <td class="border px-3 py-2">${idx + 1}</td>
      <td class="border px-3 py-2">${entry.name}</td>
      <td class="border px-3 py-2">${entry.village}</td>
      <td class="border px-3 py-2">${entry.item}</td>
      <td class="border px-3 py-2">${entry.quantity}</td>
      <td class="border px-3 py-2">
        <button class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700" onclick="deleteRow(${idx})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  renderSummary();
}

function renderSummary() {
  const summaryDiv = document.getElementById('summary');
  summaryDiv.innerHTML = '';

  if (data.length === 0) {
    summaryDiv.textContent = "No entries available.";
    return;
  }

  let totalQuantity = data.reduce((sum, e) => sum + e.quantity, 0);
  const counts = {};
  const namesMapping = {};

  data.forEach(e => {
    const norm = normalizeItemName(e.item);
    counts[norm] = (counts[norm] || 0) + e.quantity;
    if (!namesMapping[norm]) namesMapping[norm] = e.item;
  });

  const duplicates = {};
  const uniques = {};
  for (const key in counts) {
    const countEntries = data.filter(d => normalizeItemName(d.item) === key).length;
    if (countEntries > 1) {
      duplicates[key] = counts[key];
    } else {
      uniques[key] = counts[key];
    }
  }

  let totalRepeatedQuantity = Object.values(duplicates).reduce((a, b) => a + b, 0);
  let totalUniqueQuantity = Object.values(uniques).reduce((a, b) => a + b, 0);

  summaryDiv.innerHTML += `<div>Total Quantity (All Items): ${totalQuantity}</div>`;
  summaryDiv.innerHTML += `<div>Total Repeated Quantity: ${totalRepeatedQuantity}</div>`;
  summaryDiv.innerHTML += `<div>Total Unique Quantity: ${totalUniqueQuantity}</div>`;

  if (Object.keys(duplicates).length > 0) {
    summaryDiv.innerHTML += `<div class="mt-3 underline font-semibold">Repeated Items Summary:</div>`;
    const ul = document.createElement('ul');
    ul.classList.add('list-disc', 'ml-5', 'text-red-700');
    for (const norm in duplicates) {
      const li = document.createElement('li');
      li.textContent = `${namesMapping[norm]}: ${duplicates[norm]}`;
      ul.appendChild(li);
    }
    summaryDiv.appendChild(ul);
  }
}

// Heading set
document.getElementById('addHeadingBtn').addEventListener('click', () => {
  const input = document.getElementById('topHeading');
  heading = input.value.trim() || "Item Entry List";
  document.getElementById('headingDisplay').textContent = heading;
  localStorage.setItem('heading', heading);
  alert(`Heading updated to: "${heading}"`);
});

function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.getWidth();

  const now = new Date();
  const dateStr = now.toLocaleDateString();
  const timeStr = now.toLocaleTimeString();
  const dateTimeStr = `Date: ${dateStr}   Time: ${timeStr}`;

  doc.setFontSize(18);
  doc.setTextColor(0, 0, 128);
  const headingWidth = doc.getTextWidth(heading);
  const headingX = (pageWidth - headingWidth) / 2;
  doc.text(heading, headingX, 14);

  doc.setFontSize(9);
  doc.setTextColor(100);
  const dtWidth = doc.getTextWidth(dateTimeStr);
  const dtX = (pageWidth - dtWidth) / 2;
  doc.text(dateTimeStr, dtX, 20);

  const columns = [
    { header: 'NO', dataKey: 'no' },
    { header: 'Name', dataKey: 'name' },
    { header: 'Village', dataKey: 'village' },
    { header: 'Item Name', dataKey: 'item' },
    { header: 'Quantity', dataKey: 'quantity' },
  ];

  const rows = data.map((e, idx) => ({
    no: idx + 1,
    name: e.name,
    village: e.village,
    item: e.item,
    quantity: e.quantity,
  }));

  const chunkSize = 31;
  let startY = 25;

  for (let i = 0; i < rows.length; i += chunkSize) {
    const chunk = rows.slice(i, i + chunkSize);

    doc.autoTable({
      startY: startY,
      head: [columns.map(c => c.header)],
      body: chunk.map(r => columns.map(c => r[c.dataKey])),
      styles: {
        fontSize: 9,
        cellPadding: 2,
        lineWidth: 0.1,
        lineColor: [200, 200, 200],
        textColor: [0, 0, 0],
        fillColor: [255, 255, 255],
      },
      headStyles: {
        fillColor: [100, 149, 237],
        textColor: [255, 255, 255],
        fontStyle: 'bold',
        lineWidth: 0.1,
        lineColor: [200, 200, 200],
      },
      alternateRowStyles: {},
      theme: 'grid',
    });

    startY = 10; // अगले page पर शुरू करने के लिए top margin

    if (i + chunkSize < rows.length) {
      doc.addPage();
    }
  }

  const finalY = doc.lastAutoTable.finalY || 25;
  let totalQuantity = data.reduce((sum, e) => sum + e.quantity, 0);

  const counts = {};
  const namesMapping = {};
  data.forEach(e => {
    const norm = normalizeItemName(e.item);
    counts[norm] = (counts[norm] || 0) + e.quantity;
    if (!namesMapping[norm]) namesMapping[norm] = e.item;
  });

  const duplicates = {};
  const uniques = {};
  for (const key in counts) {
    const countEntries = data.filter(d => normalizeItemName(d.item) === key).length;
    if (countEntries > 1) {
      duplicates[key] = counts[key];
    } else {
      uniques[key] = counts[key];
    }
  }

  let totalRepeatedQuantity = Object.values(duplicates).reduce((a, b) => a + b, 0);
  let totalUniqueQuantity = Object.values(uniques).reduce((a, b) => a + b, 0);

  doc.setFontSize(11);
  doc.setTextColor(0, 0, 128);
  doc.text(`Summary:`, 14, finalY + 10);
  doc.setFontSize(10);
  doc.setTextColor(0);

  doc.text(`Total Quantity (All Items): ${totalQuantity}`, 14, finalY + 18);
  doc.text(`Total Repeated Quantity: ${totalRepeatedQuantity}`, 14, finalY + 26);
  doc.text(`Total Unique Quantity: ${totalUniqueQuantity}`, 14, finalY + 34);

  if (Object.keys(duplicates).length > 0) {
    doc.setTextColor(0, 0, 128);
    doc.text(`Repeated Items:`, 14, finalY + 44);
    doc.setTextColor(150, 0, 0);
    let y = finalY + 52;
    for (const norm in duplicates) {
      doc.text(`${namesMapping[norm]}: ${duplicates[norm]}`, 18, y);
      y += 8;
      if (y > 280) {
        doc.addPage();
        y = 20;
      }
    }
  }

  doc.save(`${heading.replace(/\s+/g, '_') || 'item_entry'}.pdf`);
}

document.getElementById('headingDisplay').textContent = heading;

renderTable();

</script>
</body>
</html>
